<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"coderzc.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="1. kubernetes 起源与发展   1.1 kubernetes 起源  * Kubernetes最初源于谷歌内部的Borg，Kubernetes 的最初目标是为应用的容器化编排部署提供一个最小化的平台，包含几个基本功能： 1. 将应用水平扩容到多个集群     2. 为扩容的实例提供负载均衡的策略     3. 提供基本的健康检查和自愈能力     4. 实现任务的统一调度">
<meta property="og:type" content="article">
<meta property="og:title" content="kubernetes">
<meta property="og:url" content="https://coderzc.github.io/2021/08/01/%E5%AE%B9%E5%99%A8%E5%8C%96/20210801-kubernetes/index.html">
<meta property="og:site_name" content="coderzc的博客">
<meta property="og:description" content="1. kubernetes 起源与发展   1.1 kubernetes 起源  * Kubernetes最初源于谷歌内部的Borg，Kubernetes 的最初目标是为应用的容器化编排部署提供一个最小化的平台，包含几个基本功能： 1. 将应用水平扩容到多个集群     2. 为扩容的实例提供负载均衡的策略     3. 提供基本的健康检查和自愈能力     4. 实现任务的统一调度">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/coderzc/blogimage/raw/master/20210513152302.png">
<meta property="og:image" content="https://gitee.com/coderzc/blogimage/raw/master/20210513152213.svg">
<meta property="article:published_time" content="2021-07-31T16:00:00.000Z">
<meta property="article:modified_time" content="2021-08-18T02:58:32.968Z">
<meta property="article:author" content="coderzc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/coderzc/blogimage/raw/master/20210513152302.png">


<link rel="canonical" href="https://coderzc.github.io/2021/08/01/%E5%AE%B9%E5%99%A8%E5%8C%96/20210801-kubernetes/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://coderzc.github.io/2021/08/01/%E5%AE%B9%E5%99%A8%E5%8C%96/20210801-kubernetes/","path":"2021/08/01/容器化/20210801-kubernetes/","title":"kubernetes"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>kubernetes | coderzc的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">coderzc的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-kubernetes-%E8%B5%B7%E6%BA%90%E4%B8%8E%E5%8F%91%E5%B1%95"><span class="nav-number">1.</span> <span class="nav-text">1. kubernetes 起源与发展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-kubernetes-%E8%B5%B7%E6%BA%90"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 kubernetes 起源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-kubernetes-%E5%8F%91%E5%B1%95"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 kubernetes 发展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81kubernetes"><span class="nav-number">2.</span> <span class="nav-text">2. 为什么需要kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E7%97%9B%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 传统的容器编排痛点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Kubernetes-%E8%83%BD%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 Kubernetes 能解决的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8-Kubernetes%EF%BC%9F"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 什么时候使用 Kubernetes？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%B8%8D%E9%80%82%E5%90%88%E4%BD%BF%E7%94%A8-Kubernetes"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 什么时候不适合使用 Kubernetes</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Kubernetes-%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">3.</span> <span class="nav-text">3. Kubernetes 架构与核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E4%B8%BB%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E7%BB%84%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 主控制节点组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E4%BB%8E%E8%8A%82%E7%82%B9%E7%BB%84%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 从节点组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E6%8F%92%E4%BB%B6%EF%BC%88Addons%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 插件（Addons）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="nav-number">4.</span> <span class="nav-text">4. 初始化基础环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%88%9D%E5%A7%8B%E5%8C%96-Master"><span class="nav-number">5.</span> <span class="nav-text">5. 初始化 Master</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%88%9D%E5%A7%8B%E5%8C%96-WorkerNode"><span class="nav-number">6.</span> <span class="nav-text">6. 初始化 WorkerNode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%AE%89%E8%A3%85-Kubernetes-Dashboard"><span class="nav-number">7.</span> <span class="nav-text">7. 安装 Kubernetes Dashboard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Pod"><span class="nav-number">8.</span> <span class="nav-text">8. Pod</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">coderzc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/coderzc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;coderzc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zc1217zc@126.com" title="E-Mail → mailto:zc1217zc@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://coderzc.github.io/2021/08/01/%E5%AE%B9%E5%99%A8%E5%8C%96/20210801-kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="coderzc">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="coderzc的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          kubernetes
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-08-01T00:00:00+08:00">2021-08-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-18 10:58:32" itemprop="dateModified" datetime="2021-08-18T10:58:32+08:00">2021-08-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">容器化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="1-kubernetes-起源与发展"><a href="#1-kubernetes-起源与发展" class="headerlink" title="1. kubernetes 起源与发展"></a>1. kubernetes 起源与发展</h2><p><img src="https://gitee.com/coderzc/blogimage/raw/master/20210513152302.png" alt="20210512181906"></p>
<h3 id="1-1-kubernetes-起源"><a href="#1-1-kubernetes-起源" class="headerlink" title="1.1 kubernetes 起源"></a>1.1 kubernetes 起源</h3><ul>
<li>Kubernetes最初源于谷歌内部的Borg，Kubernetes 的最初目标是为应用的容器化编排部署提供一个最小化的平台，包含几个基本功能：<ol>
<li>将应用水平扩容到多个集群</li>
<li>为扩容的实例提供负载均衡的策略</li>
<li>提供基本的健康检查和自愈能力</li>
<li>实现任务的统一调度</li>
</ol>
</li>
</ul>
<h3 id="1-2-kubernetes-发展"><a href="#1-2-kubernetes-发展" class="headerlink" title="1.2 kubernetes 发展"></a>1.2 kubernetes 发展</h3><ul>
<li>2014年6月 谷歌云计算专家Eric Brewer在旧金山的发布会为这款新的开源工具揭牌。</li>
<li>2015年7月22日K8S迭代到 v1.0并在OSCON大会上正式对外公布。</li>
<li>为了建立容器编排领域的标准和规范，Google、RedHat 等开源基础设施领域玩家们，在 2015 年共同牵头发起了名为 CNCF（Cloud Native Computing Foundation）的基金会。Kubernetes 成为 CNCF 最核心的项目。发起成员：AT&amp;T, Box, Cisco, Cloud Foundry Foundation, CoreOS, Cycle Computing, Docker, eBay, Goldman Sachs, Google, Huawei, IBM, Intel, Joyent, Kismatic, Mesosphere, Red Hat, Switch SUPERNAP, Twitter, Univa, VMware and Weaveworks。</li>
<li>2018年，超过 1700 开发者成为 Kubernetes 项目社区贡献者，全球有 500 多场沙龙。国内出现大量基于 Kubernetes 的创业公司。</li>
<li>2020 年，Kubernetes 项目已经成为贡献者仅次于 Linux 项目的第二大开源项目。成为了业界容器编排的事实标准，各大厂商纷纷宣布支持 Kubernetes 作为容器编排的方案。</li>
</ul>
<h2 id="2-为什么需要kubernetes"><a href="#2-为什么需要kubernetes" class="headerlink" title="2. 为什么需要kubernetes"></a>2. 为什么需要kubernetes</h2><h3 id="2-1-传统的容器编排痛点"><a href="#2-1-传统的容器编排痛点" class="headerlink" title="2.1 传统的容器编排痛点"></a>2.1 传统的容器编排痛点</h3><p>容器技术虽然解决了应用和基础设施异构的问题，让应用可以做到一次构建，多次部署，但在复杂的微服务场景，单靠 Docker 技术还不够，它仍然有以下问题没有解决：</p>
<ul>
<li>集成和编排微服务模块</li>
<li>提供按需自动扩容，缩容能力</li>
<li>故障自愈</li>
<li>集群内的通信</li>
</ul>
<h3 id="2-2-Kubernetes-能解决的问题"><a href="#2-2-Kubernetes-能解决的问题" class="headerlink" title="2.2 Kubernetes 能解决的问题"></a>2.2 Kubernetes 能解决的问题</h3><ul>
<li>按需的垂直扩容，新的服务器(node)能够轻易的增加或删除</li>
<li>按需的水平扩容，容器实例能够轻松扩容，缩容</li>
<li>副本控制器，你不用担心副本的状态</li>
<li>服务发现和路由</li>
<li>自动部署和回滚，如果应用状态错误，可以实现自动回滚</li>
</ul>
<h3 id="2-3-什么时候使用-Kubernetes？"><a href="#2-3-什么时候使用-Kubernetes？" class="headerlink" title="2.3 什么时候使用 Kubernetes？"></a>2.3 什么时候使用 Kubernetes？</h3><ul>
<li>当你的应用是微服务架构</li>
<li>开发者需要快速部署自己的新功能到测试环境进行验证</li>
<li>降低硬件资源成本，提高使用率</li>
</ul>
<h3 id="2-4-什么时候不适合使用-Kubernetes"><a href="#2-4-什么时候不适合使用-Kubernetes" class="headerlink" title="2.4 什么时候不适合使用 Kubernetes"></a>2.4 什么时候不适合使用 Kubernetes</h3><ul>
<li>应用是轻量级的单体应用，没有高并发的需求</li>
<li>团队文化不适应变革</li>
</ul>
<h2 id="3-Kubernetes-架构与核心概念"><a href="#3-Kubernetes-架构与核心概念" class="headerlink" title="3. Kubernetes 架构与核心概念"></a>3. Kubernetes 架构与核心概念</h2><p><img src="https://gitee.com/coderzc/blogimage/raw/master/20210513152213.svg" alt="Components of Kubernetes"></p>
<h3 id="3-1-主控制节点组件"><a href="#3-1-主控制节点组件" class="headerlink" title="3.1 主控制节点组件"></a>3.1 主控制节点组件</h3><p>主控制节点组件对集群做出全局决策(比如调度)，以及检测和响应集群事件（例如，当不满足部署的 replicas 字段时，启动新的 pod）。</p>
<p>主控制节点组件可以在集群中的任何节点上运行。 然而，为了简单起见，设置脚本通常会在同一个计算机上启动所有主控制节点组件，并且不会在此计算机上运行用户容器。</p>
<ul>
<li><p>apiserver<br>主节点上负责提供 Kubernetes API 服务的组件；它是 Kubernetes 控制面的前端组件。</p>
</li>
<li><p>etcd<br>etcd 是兼具一致性和高可用性的键值数据库，可以作为保存 Kubernetes 所有集群数据的后台数据库。</p>
</li>
<li><p>kube-scheduler<br>主节点上的组件，该组件监视那些新创建的未指定运行节点的 Pod，并选择节点让 Pod 在上面运行。<br>调度决策考虑的因素包括单个 Pod 和 Pod 集合的资源需求、硬件/软件/策略约束、亲和性和反亲和性规范、数据位置、工作负载间的干扰和最后时限。</p>
</li>
<li><p>kube-controller-manager<br>在主节点上运行控制器的组件。<br>从逻辑上讲，每个控制器都是一个单独的进程，但是为了降低复杂性，它们都被编译到同一个可执行文件，并在一个进程中运行。这些控制器包括:</p>
<pre><code>1. 节点控制器（Node Controller）: 负责在节点出现故障时进行通知和响应。
2. 副本控制器（Replication Controller）: 负责为系统中的每个副本控制器对象维护正确数量的 Pod。
3. 终端控制器（Endpoints Controller）: 填充终端(Endpoints)对象(即加入 Service 与 Pod)。
4. 服务帐户和令牌控制器（Service Account &amp; Token Controllers），为新的命名空间创建默认帐户和 API 访问令牌.
</code></pre>
</li>
</ul>
<h3 id="3-2-从节点组件"><a href="#3-2-从节点组件" class="headerlink" title="3.2 从节点组件"></a>3.2 从节点组件</h3><p>节点组件在每个节点上运行，维护运行的 Pod 并提供 Kubernetes 运行环境。</p>
<ul>
<li>kubelet<br>一个在集群中每个节点上运行的代理。它保证容器都运行在 Pod 中。kubelet 接收一组通过各类机制提供给它的 PodSpecs，确保这些 PodSpecs 中描述的容器处于运行状态且健康。kubelet 不会管理不是由 Kubernetes 创建的容器。</li>
<li>kube-proxy<br>kube-proxy 是集群中每个节点上运行的网络代理,实现 Kubernetes Service 概念的一部分。<br>kube-proxy 维护节点上的网络规则。这些网络规则允许从集群内部或外部的网络会话与 Pod 进行网络通信。</li>
<li>容器运行时（Container Runtime）<br>容器运行环境是负责运行容器的软件。<br>Kubernetes 支持多个容器运行环境: Docker、 containerd、cri-o、 rktlet 以及任何实现 Kubernetes CRI (容器运行环境接口)。</li>
</ul>
<h3 id="3-3-插件（Addons）"><a href="#3-3-插件（Addons）" class="headerlink" title="3.3 插件（Addons）"></a>3.3 插件（Addons）</h3><ul>
<li><p>Kubeadm </p>
<p>Kubeadm 是Kubernetes的自动化部署工具，降低了部署难度，提高效率。</p>
</li>
<li><p>Kubectl </p>
<p>Kubectl 是Kubernetes集群管理工具相当于客户端。</p>
</li>
<li><p>DNS<br>尽管其他插件都并非严格意义上的必需组件，但几乎所有 Kubernetes 集群都应该有集群 DNS， 因为很多示例都需要 DNS 服务。</p>
</li>
<li><p>Web 界面（仪表盘）<br>Dashboard 是K ubernetes 集群的通用的、基于 Web 的用户界面。 它使用户可以管理集群中运行的应用程序以及集群本身并进行故障排除。</p>
</li>
<li><p>容器资源监控<br>容器资源监控 将关于容器的一些常见的时间序列度量值保存到一个集中的数据库中，并提供用于浏览这些数据的界面。</p>
</li>
<li><p>集群层面日志<br>集群层面日志 机制负责将容器的日志数据 保存到一个集中的日志存储中，该存储能够提供搜索和浏览接口。</p>
</li>
</ul>
<h2 id="4-初始化基础环境"><a href="#4-初始化基础环境" class="headerlink" title="4. 初始化基础环境"></a>4. 初始化基础环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载yum 源</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装基本软件包</span></span><br><span class="line">yum install wget net‐tools vim bash‐comp* ‐y</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置 K8S的阿里云yum源</span></span><br><span class="line">cat &gt;&gt;/etc/yum.repos.d/kubernetes.repo &lt;&lt;EOF</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 Docker yum源</span></span><br><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置hosts</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"> 192.168.99.101 master</span><br><span class="line"> 192.168.99.102 node1</span><br><span class="line"> 192.168.99.103 node2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭 SeLinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭 swap</span></span><br><span class="line">swapoff -a</span><br><span class="line">yes | cp /etc/fstab /etc/fstab_bak</span><br><span class="line">cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将桥接的IPv4流量传递到iptables的链</span></span><br><span class="line">modprobe br_netfilter</span><br><span class="line">echo &quot;1&quot; &gt;/proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line">vi /etc/sysctl.d/k8s.conf </span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装并启动 docker</span></span><br><span class="line">yum install -y docker-ce.x86_64 docker-ce-cli.x86_64 containerd.io.x86_64</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更换 docker 镜像源</span></span><br><span class="line">mkdir /etc/docker</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://registry.cn-hangzhou.aliyuncs.com&quot;],</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启docker</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机自启</span></span><br><span class="line">systemctl enable docker </span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果报网络错误可能是没有成功建立docker网卡，可以手动创建</span></span><br><span class="line">`failed to start daemon: Error initializing network controller: list bridge addresses failed: PredefinedLocalScopeDefaultNetworks List:`</span><br><span class="line">ip link add name docker0 type bridge</span><br><span class="line">ip addr add dev docker0 172.1.0.1/16</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装kubelet、kubeadm、kubectl</span></span><br><span class="line">yum install -y kubelet-1.15.10 kubeadm-1.15.10 kubectl-1.15.10</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 kubelet</span></span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>

<h2 id="5-初始化-Master"><a href="#5-初始化-Master" class="headerlink" title="5. 初始化 Master"></a>5. 初始化 Master</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 初始化K8s主节点</span></span><br><span class="line">kubeadm init --kubernetes-version=1.15.10 \</span><br><span class="line">--apiserver-advertise-address=$&#123;master_ip&#125; \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br><span class="line"></span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装网络插件 Flannel</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看K8s状态</span></span><br><span class="line">kubectl get node</span><br><span class="line">	NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">	master   Ready    master   14m   v1.15.10</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 故障排查 ！！！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubelet 启动失败 报错：Failed to start ContainerManager failed to get rootfs info: unable to find data <span class="keyword">in</span> memory cache</span></span><br><span class="line">vim /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf 添加下面环境变量</span><br><span class="line">Environment=&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml --feature-gates=\&quot;LocalStorageCapacityIsolation=false,SupportNodePidsLimit=false,SupportPodPidsLimit=false\&quot;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Failed to update stats <span class="keyword">for</span> container <span class="string">&quot;/kubepods.slice/kubepods-burstable.slice&quot;</span>: failure - /sys/fs/cgroup/cpuacct/kubepods.slice/kubepods-burstable.slice/cpuacct.stat</span></span><br><span class="line">cat &gt;/etc/systemd/system/kubelet.service.d/11-cgroups.conf&lt;&lt;EOF</span><br><span class="line">[Service]</span><br><span class="line">CPUAccounting=true</span><br><span class="line">MemoryAccounting=true</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">并在刚才那个环境变量上追加参数：</span><br><span class="line">Environment=&quot;KUBELET_CONFIG_ARGS=--runtime-cgroups=/systemd/system.slice --kubelet-cgroups=/systemd/system.slice&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后重启 kubelet</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<h2 id="6-初始化-WorkerNode"><a href="#6-初始化-WorkerNode" class="headerlink" title="6. 初始化 WorkerNode"></a>6. 初始化 WorkerNode</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拷贝 admin.conf 到 wokerNode</span></span><br><span class="line">scp /etc/kubernetes/admin.conf root@node1:/etc/kubernetes/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 Kubeconfig 环境变量</span></span><br><span class="line">echo &quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot; &gt;&gt; ~/.bash_profile</span><br><span class="line">source ~/.bash_profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果是克隆的 master 机器, 需要清理 master 环境网络</span></span><br><span class="line">kubeadm reset</span><br><span class="line">systemctl stop kubelet</span><br><span class="line">systemctl stop docker</span><br><span class="line">rm -rf /var/lib/cni/</span><br><span class="line">rm -rf /var/lib/kubelet/*</span><br><span class="line">rm -rf /var/cni/</span><br><span class="line">ifconfig cni0 down</span><br><span class="line">ifconfig flannel.1 down</span><br><span class="line">ifconfig docker0 down</span><br><span class="line">ip link delete cni0</span><br><span class="line">ip link delete flannel.1</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl start kubelet</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 否则安装 Flannel 网络插件</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将master节点下面 /etc/cni/net.d/下面的所有文件拷贝到node节点上</span></span><br><span class="line">mkdir -p /etc/cni/net.d/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 master</span></span><br><span class="line">scp /etc/cni/net.d/* root@$&#123;node_ip&#125;:/etc/cni/net.d/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 master 生成token</span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> kubeadm join <span class="variable">$&#123;master_ip&#125;</span>:6443 --token 56peeh.gx8l6z1vwo04usrb     --discovery-token-ca-cert-hash sha256:3ba111312aee9e77ca7939f8336db665b01ea3f457bee501117810b2d8ccfe3c</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在wokerNode上执行这个join</span></span><br><span class="line">kubeadm join $&#123;master_ip&#125;:6443 --token 56peeh.gx8l6z1vwo04usrb     --discovery-token-ca-cert-hash sha256:3ba111312aee9e77ca7939f8336db665b01ea3f457bee501117810b2d8ccfe3c</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看集群状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line">	NAME     STATUS   ROLES    AGE     VERSION</span><br><span class="line">	master   Ready    master   15m     v1.15.10</span><br><span class="line">	node1    Ready    &lt;none&gt;   9m41s   v1.15.10</span><br></pre></td></tr></table></figure>

<h2 id="7-安装-Kubernetes-Dashboard"><a href="#7-安装-Kubernetes-Dashboard" class="headerlink" title="7. 安装 Kubernetes Dashboard"></a>7. 安装 <em>Kubernetes Dashboard</em></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 Kubernetes Dashboard 根据 CRD，使用http免密登录</span></span><br><span class="line">kubectl apply -f https://github.com/coderzc/coderzc.github.io/tree/master/blog/%E5%AE%B9%E5%99%A8%E5%8C%96/recommended.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示 admin 的 token</span></span><br><span class="line">kubectl -n kube-system describe $(kubectl -n kube-system get secret -n kube-system -o name | grep namespace) | grep token</span><br></pre></td></tr></table></figure>

<h2 id="8-Pod"><a href="#8-Pod" class="headerlink" title="8. Pod"></a>8. Pod</h2><p><em>Pod</em> 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。</p>
<p><em>Pod</em> （就像在鲸鱼荚或者豌豆荚中）是一组（一个或多个） <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/#why-containers">容器</a>； 这些容器共享存储、网络、以及怎样运行这些容器的声明。 Pod 中的内容总是并置（colocated）的并且一同调度，在共享的上下文中运行。 Pod 所建模的是特定于应用的“逻辑主机”，其中包含一个或多个应用容器， 这些容器是相对紧密的耦合在一起的。 在非云环境中，在相同的物理机或虚拟机上运行的应用类似于 在同一逻辑主机上运行的云应用。</p>
<p>除了应用容器，Pod 还可以包含在 Pod 启动期间运行的 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/init-containers/">Init 容器</a>。 你也可以在集群中支持<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/ephemeral-containers/">临时性容器</a> 的情况下，为调试的目的注入临时性容器。</p>
<p>详细介绍：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods">https://kubernetes.io/zh/docs/concepts/workloads/pods</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/18/%E5%AE%B9%E5%99%A8%E5%8C%96/20210718-docker/" rel="prev" title="docker">
                  <i class="fa fa-chevron-left"></i> docker
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/08/17/%E5%88%86%E5%B8%83%E5%BC%8F/20210817-Google%E8%AE%BA%E6%96%87%E3%80%81%E5%BC%80%E6%BA%90%E4%B8%8E%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="next" title="Google论文、开源与云计算">
                  Google论文、开源与云计算 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">coderzc</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
